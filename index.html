<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Asistencia Multi-Curso</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <meta name="theme-color" content="#1D4ED8">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .app-container { min-height: 100vh; }
        ::-webkit-scrollbar { display: none; }
        body { -ms-overflow-style: none; scrollbar-width: none; }
        /* Estilos para el bot√≥n de hora activa */
        .btn-time-slot { transition: all 0.2s; }
        .btn-time-slot.active { background-color: #1D4ED8; color: white; }
    </style>
</head>
<body class="bg-gray-50 text-gray-800">

    <div id="app" class="app-container max-w-lg mx-auto p-4 flex flex-col">
        
        <header class="mb-6 pt-4 border-b pb-3">
            <h1 class="text-3xl font-extrabold text-blue-700">üìù Sistema de Asistencia</h1>
            <div class="mt-2 flex items-center space-x-2">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-gray-500" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd" />
                </svg>
                <input type="text" id="nombre-licenciado" placeholder="Su Nombre (p. ej., Lic. Mar√≠a)" onchange="guardarNombreLicenciado()" class="flex-grow p-1 text-sm border-b border-gray-300 focus:outline-none focus:border-blue-500 bg-gray-50">
            </div>
            <p id="subtitulo" class="text-sm text-gray-500 mt-2">Men√∫ Principal</p>
        </header>

        <main id="main-view" class="flex-grow">
            </main>
        
        <div id="mensaje-estado" class="fixed bottom-0 left-0 right-0 p-4 transition-all duration-300 transform translate-y-full opacity-0"></div>

    </div>

    <script>
        const STORAGE_KEY = 'asistencia_multi_curso_data';
        const LICENCIADO_KEY = 'nombre_licenciado';
        
        let datos = cargarDatosIniciales();
        let nombreLicenciado = localStorage.getItem(LICENCIADO_KEY) || '';
        let ultimoCursoId = datos.cursos.length > 0 ? Math.max(...datos.cursos.map(c => c.id)) : 0;

        const mainView = document.getElementById('main-view');
        const subtitulo = document.getElementById('subtitulo');
        const mensajeEstado = document.getElementById('mensaje-estado');
        const inputLicenciado = document.getElementById('nombre-licenciado');
        
        // Franjas horarias basadas en el horario adjunto
        const FRANJAS_HORARIAS = [
            "7:00 - 7:40", "7:40 - 8:20", "8:20 - 9:00", 
            "9:00 - 9:40 (RECESO)", 
            "9:40 - 10:10", "10:10 - 10:50", "10:50 - 11:30", 
            "11:30 - 12:10", "12:10 - 12:50", "12:50 - 1:30"
        ];
        
        // Inicializar el input del licenciado al cargar
        inputLicenciado.value = nombreLicenciado;

        // --- Persistencia y Utilidades ---

        function cargarDatosIniciales() {
            try {
                const data = localStorage.getItem(STORAGE_KEY);
                const defaultData = {
                    cursos: [
                        { id: 1, nombre: "2do Bach. Inform√°tica 'M'", estudiantes: [] } // Curso de ejemplo
                    ],
                    sesiones: []
                };
                
                if (!data) return defaultData;

                const loadedData = JSON.parse(data);
                // Asegurar que el objeto loadedData tenga ambas propiedades
                return {
                    cursos: loadedData.cursos || defaultData.cursos,
                    sesiones: loadedData.sesiones || defaultData.sesiones
                };
            } catch (error) {
                console.error("Error al cargar datos:", error);
                return { cursos: [], sesiones: [] };
            }
        }

        function guardarDatos() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(datos));
        }

        function guardarNombreLicenciado() {
            nombreLicenciado = inputLicenciado.value.trim();
            localStorage.setItem(LICENCIADO_KEY, nombreLicenciado);
            mostrarMensaje(`üë§ Nombre guardado como: ${nombreLicenciado}`);
        }

        function mostrarMensaje(texto, tipo = 'success') {
            const color = tipo === 'success' ? 'bg-green-500' : 'bg-red-500';
            mensajeEstado.className = `fixed bottom-0 left-0 right-0 p-4 transition-all duration-300 transform translate-y-0 opacity-100 text-white font-bold text-center ${color} shadow-lg`;
            mensajeEstado.textContent = texto;

            setTimeout(() => {
                mensajeEstado.className = 'fixed bottom-0 left-0 right-0 p-4 transition-all duration-300 transform translate-y-full opacity-0';
            }, 3000);
        }

        // --- 1. Navegaci√≥n (FIX DEL BOT√ìN VOLVER) ---

        // Funci√≥n para generar el bot√≥n de volver
        function generarBotonVolver() {
            return `
                <button onclick="mostrarVista('menu')" class="mb-4 text-blue-600 hover:text-blue-800 font-medium flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                    Volver al Men√∫
                </button>
            `;
        }

        function mostrarVista(vista, cursoId = null) {
            let titulo = '';
            let contenido = '';

            // Si no es el men√∫ principal, agregamos el bot√≥n de volver
            if (vista !== 'menu') {
                contenido += generarBotonVolver();
            }

            switch (vista) {
                case 'menu':
                    titulo = 'Men√∫ Principal';
                    // Re-creamos el men√∫ directamente en JS para asegurar que el bot√≥n funcione
                    contenido = `
                        <div id="menu-principal" class="space-y-4">
                            <button onclick="mostrarVista('cursos-gestion')" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-md transition duration-150">
                                üë• Gestionar Cursos y Listas
                            </button>
                            <button onclick="mostrarVista('cursos-asistencia')" class="w-full bg-green-600 hover:bg-green-700 text-white font-bold py-3 rounded-lg shadow-md transition duration-150">
                                ‚úÖ Tomar Asistencia
                            </button>
                            <button onclick="mostrarVista('historial')" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-3 rounded-lg shadow-md transition duration-150">
                                üìö Ver Historial
                            </button>
                            <button onclick="mostrarVista('acerca')" class="w-full bg-gray-400 hover:bg-gray-500 text-white font-bold py-2 rounded-lg transition duration-150 text-sm">
                                Acerca de / Instrucciones
                            </button>
                        </div>
                    `;
                    break;
                case 'cursos-gestion':
                    titulo = 'üìö Gesti√≥n de Cursos';
                    contenido += generarVistaCursosGestion();
                    break;
                case 'gestionar-lista':
                    titulo = '‚úçÔ∏è Lista de Estudiantes';
                    contenido += generarVistaGestionarLista(parseInt(cursoId));
                    break;
                case 'cursos-asistencia':
                    titulo = 'Seleccionar Curso para Asistencia';
                    contenido += generarVistaSeleccionarCursoAsistencia();
                    break;
                case 'tomar-asistencia':
                    titulo = '‚úÖ Tomar Asistencia';
                    contenido += generarVistaTomarAsistencia(parseInt(cursoId));
                    break;
                case 'historial':
                    titulo = 'üìö Historial de Asistencia';
                    contenido += generarVistaHistorial();
                    break;
                case 'acerca':
                    titulo = 'Acerca de';
                    contenido += generarVistaAcerca();
                    break;
                default:
                    return;
            }

            subtitulo.textContent = titulo;
            mainView.innerHTML = contenido;
        }

        // --- 2. Gesti√≥n de Cursos (Nuevas Vistas) ---

        function generarVistaCursosGestion() {
            const listaCursosHTML = datos.cursos.map(curso => `
                <li class="flex flex-col sm:flex-row justify-between items-center p-3 bg-white rounded-lg shadow-sm border border-gray-100">
                    <span class="font-medium text-gray-700 w-full sm:w-1/2 mb-2 sm:mb-0">
                        ${curso.nombre} <span class="text-sm text-gray-500">(${curso.estudiantes.length} alumnos)</span>
                    </span>
                    <div class="flex space-x-2 w-full sm:w-auto justify-end">
                        <button onclick="mostrarVista('gestionar-lista', ${curso.id})" class="bg-blue-500 hover:bg-blue-600 text-white text-xs font-bold py-1 px-3 rounded-md">
                            Ver Lista
                        </button>
                        <button onclick="eliminarCurso(${curso.id})" class="text-red-500 hover:text-red-700 text-xs font-bold py-1 px-3 rounded-md border border-red-500">
                            Eliminar
                        </button>
                    </div>
                </li>
            `).join('');

            return `
                <div class="mt-4">
                    <h2 class="text-xl font-semibold mb-3">A√±adir Nuevo Curso</h2>
                    <div class="flex space-x-2 mb-6">
                        <input type="text" id="nuevo-curso-nombre" placeholder="Nombre del Curso (Ej: 3ro Contabilidad A)" class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        <button onclick="agregarCurso()" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-4 rounded-lg">
                            Crear
                        </button>
                    </div>

                    <h2 class="text-xl font-semibold mb-3">Cursos Existentes (${datos.cursos.length})</h2>
                    <ul class="space-y-2">
                        ${listaCursosHTML || '<p class="text-gray-500 text-center py-4">No hay cursos creados. ¬°Cree uno!</p>'}
                    </ul>
                </div>
            `;
        }

        function agregarCurso() {
            const input = document.getElementById('nuevo-curso-nombre');
            const nombre = input.value.trim();

            if (nombre) {
                ultimoCursoId++;
                datos.cursos.push({ id: ultimoCursoId, nombre: nombre, estudiantes: [] });
                guardarDatos();
                input.value = '';
                mostrarMensaje(`‚úÖ Curso "${nombre}" creado.`);
                mostrarVista('cursos-gestion');
            } else {
                mostrarMensaje('‚ùå El nombre del curso no puede estar vac√≠o.', 'error');
            }
        }

        function eliminarCurso(id) {
            const curso = datos.cursos.find(c => c.id === id);
            if (confirm(`‚ö†Ô∏è ADVERTENCIA: ¬øEst√°s seguro de eliminar el curso "${curso.nombre}"? Esto eliminar√° tambi√©n a sus ${curso.estudiantes.length} estudiantes.`)) {
                datos.cursos = datos.cursos.filter(c => c.id !== id);
                guardarDatos();
                mostrarMensaje(`üóëÔ∏è Curso "${curso.nombre}" eliminado.`);
                mostrarVista('cursos-gestion');
            }
        }

        function generarVistaGestionarLista(cursoId) {
            const curso = datos.cursos.find(c => c.id === cursoId);
            if (!curso) return '<p class="text-red-500 text-center py-10">Curso no encontrado.</p>';

            subtitulo.textContent = `‚úçÔ∏è Lista: ${curso.nombre}`;
            
            // Ordenar por nombre
            const listaEstudiantes = curso.estudiantes.sort((a, b) => a.nombre.localeCompare(b.nombre));
            
            let listaHTML = listaEstudiantes.length > 0 
                ? listaEstudiantes.map(e => `
                    <li class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm border border-gray-100">
                        <span class="font-medium text-gray-700">${e.nombre}</span>
                        <button onclick="eliminarEstudianteDeCurso(${curso.id}, ${e.id})" class="text-red-500 hover:text-red-700 text-sm font-bold ml-4">
                            Eliminar
                        </button>
                    </li>
                `).join('')
                : '<p class="text-gray-500 text-center py-4">Este curso no tiene estudiantes.</p>';

            return `
                <button onclick="mostrarVista('cursos-gestion')" class="mb-4 text-blue-600 hover:text-blue-800 font-medium flex items-center">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path fill-rule="evenodd" d="M9.707 16.707a1 1 0 01-1.414 0l-6-6a1 1 0 010-1.414l6-6a1 1 0 011.414 1.414L5.414 9H17a1 1 0 110 2H5.414l4.293 4.293a1 1 0 010 1.414z" clip-rule="evenodd" />
                    </svg>
                    Volver a Cursos
                </button>
                <div class="mt-4">
                    <h2 class="text-xl font-semibold mb-3">A√±adir Estudiante a ${curso.nombre}</h2>
                    <div class="flex space-x-2 mb-6">
                        <input type="text" id="nuevo-nombre" placeholder="Nombre completo del estudiante" class="flex-grow p-2 border border-gray-300 rounded-lg focus:ring-blue-500 focus:border-blue-500">
                        <button onclick="agregarEstudianteACurso(${curso.id})" class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg">
                            A√±adir
                        </button>
                    </div>

                    <h2 class="text-xl font-semibold mb-3">Lista de Estudiantes (${listaEstudiantes.length})</h2>
                    <ul class="space-y-2">
                        ${listaHTML}
                    </ul>
                </div>
            `;
        }

        function agregarEstudianteACurso(cursoId) {
            const curso = datos.cursos.find(c => c.id === cursoId);
            if (!curso) return;

            const input = document.getElementById('nuevo-nombre');
            const nombre = input.value.trim();

            if (nombre) {
                // Generar un ID local al curso
                const nuevoId = curso.estudiantes.length > 0 ? Math.max(...curso.estudiantes.map(e => e.id)) + 1 : 1; 
                curso.estudiantes.push({ id: nuevoId, nombre: nombre });
                guardarDatos();
                input.value = '';
                mostrarMensaje(`‚úÖ "${nombre}" a√±adido a ${curso.nombre}.`);
                mostrarVista('gestionar-lista', cursoId);
            } else {
                mostrarMensaje('‚ùå El nombre no puede estar vac√≠o.', 'error');
            }
        }

        function eliminarEstudianteDeCurso(cursoId, estudianteId) {
            const curso = datos.cursos.find(c => c.id === cursoId);
            if (!curso) return;

            const estudiante = curso.estudiantes.find(e => e.id === estudianteId);
            if (confirm(`¬øEst√°s seguro de eliminar a "${estudiante.nombre}" de este curso?`)) {
                curso.estudiantes = curso.estudiantes.filter(e => e.id !== estudianteId);
                guardarDatos();
                mostrarMensaje(`üóëÔ∏è Estudiante "${estudiante.nombre}" eliminado.`);
                mostrarVista('gestionar-lista', cursoId);
            }
        }

        // --- 3. Tomar Asistencia (Con Franja Horaria) ---
        
        function generarVistaSeleccionarCursoAsistencia() {
            if (datos.cursos.length === 0) {
                 return '<p class="text-red-500 text-center py-10">‚ùå ¬°No hay cursos! Ve a "Gestionar Cursos" para crear uno.</p>';
            }
            
            const listaCursosHTML = datos.cursos.map(curso => `
                <li class="flex justify-between items-center p-3 bg-white rounded-lg shadow-md border border-gray-200 hover:bg-gray-50 transition duration-150">
                    <span class="font-bold text-gray-700">${curso.nombre}</span>
                    <button onclick="mostrarVista('tomar-asistencia', ${curso.id})" class="bg-green-600 hover:bg-green-700 text-white text-sm font-bold py-2 px-4 rounded-md">
                        Seleccionar
                    </button>
                </li>
            `).join('');

            return `
                <div class="mt-4">
                    <h2 class="text-xl font-semibold mb-3">Selecciona el curso al que pasar√°s lista</h2>
                    <ul class="space-y-3">
                        ${listaCursosHTML}
                    </ul>
                </div>
            `;
        }

        function generarVistaTomarAsistencia(cursoId) {
            const curso = datos.cursos.find(c => c.id === cursoId);
            if (!curso || curso.estudiantes.length === 0) {
                return `<p class="text-red-500 text-center py-10">‚ùå El curso **${curso ? curso.nombre : 'no existe'}** no tiene estudiantes. Agrega alumnos primero.</p>`;
            }
            if (!nombreLicenciado) {
                 return `<p class="text-red-500 text-center py-10">‚ùå Por favor, ingrese su nombre en la parte superior antes de tomar asistencia.</p>`;
            }

            const hoy = new Date().toLocaleDateString('es-ES', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            
            // Franjas horarias
            const franjasHTML = FRANJAS_HORARIAS.map((franja, index) => `
                <button data-time="${franja}" onclick="seleccionarFranja(this)" class="btn-time-slot bg-gray-200 hover:bg-gray-300 text-gray-700 text-xs font-medium py-1 px-2 rounded-full mb-1">
                    ${franja}
                </button>
            `).join('');
            
            // Estudiantes: Se a√±ade data-status="presente" por defecto
            const listaHTML = curso.estudiantes
                .sort((a, b) => a.nombre.localeCompare(b.nombre))
                .map(e => `
                    <li class="flex justify-between items-center p-3 bg-white rounded-lg shadow-sm border border-gray-100" data-id="${e.id}" data-status="presente">
                        <span class="font-medium text-gray-700">${e.nombre}</span>
                        <div class="flex items-center space-x-2">
                            <span class="estado-label text-green-600 font-bold w-20 text-right">PRESENTE</span>
                            <button onclick="marcarAusente(this)" class="bg-red-500 hover:bg-red-600 text-white text-xs font-bold py-1 px-2 rounded-full transition duration-150">
                                Marcar Ausente
                            </button>
                        </div>
                    </li>
                `).join('');

            return `
                <div class="mt-4" data-curso-id="${curso.id}">
                    <p class="text-lg font-bold text-blue-700 mb-2">Curso: ${curso.nombre}</p>
                    <p class="text-sm font-semibold text-gray-600 mb-4">Fecha: ${hoy}</p>
                    
                    <h3 class="font-bold text-gray-700 mb-2">1. Seleccione la Franja Horaria (Puede seleccionar varias)</h3>
                    <div id="franjas-contenedor" class="flex flex-wrap gap-2 p-3 bg-gray-100 rounded-lg mb-4">
                        ${franjasHTML}
                    </div>
                    
                    <h3 class="font-bold text-gray-700 mb-2">2. Introduzca Materia y Tema</h3>
                    <input type="text" id="materia-input" placeholder="Materia (Ej: Matem√°ticas)" class="w-full p-2 border border-gray-300 rounded-lg mb-2 focus:ring-blue-500 focus:border-blue-500">
                    <input type="text" id="tema-input" placeholder="Tema/Contenido (Opcional)" class="w-full p-2 border border-gray-300 rounded-lg mb-4 focus:ring-blue-500 focus:border-blue-500">

                    <h3 class="font-bold text-gray-700 mb-3">3. Listado de Estudiantes (${curso.estudiantes.length})</h3>
                    <ul id="lista-asistencia" class="space-y-2 mb-6">
                        ${listaHTML}
                    </ul>
                    
                    <button onclick="finalizarAsistencia(${curso.id})" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-xl">
                        GUARDAR ASISTENCIA
                    </button>
                </div>
            `;
        }

        function seleccionarFranja(boton) {
            // Alternar la clase 'active' para permitir seleccionar varias franjas
            boton.classList.toggle('active');
        }

        function marcarAusente(boton) {
            const listItem = boton.closest('li');
            const label = listItem.querySelector('.estado-label');
            
            if (listItem.dataset.status === 'ausente') {
                listItem.dataset.status = 'presente';
                label.textContent = 'PRESENTE';
                label.classList.replace('text-red-600', 'text-green-600');
                boton.textContent = 'Marcar Ausente';
                boton.classList.replace('bg-green-500', 'bg-red-500');
            } else {
                listItem.dataset.status = 'ausente';
                label.textContent = 'AUSENTE';
                label.classList.replace('text-green-600', 'text-red-600');
                boton.textContent = 'Marcar Presente';
                boton.classList.replace('bg-red-500', 'bg-green-500');
            }
        }

        function finalizarAsistencia(cursoId) {
            const curso = datos.cursos.find(c => c.id === cursoId);
            
            const materia = document.getElementById('materia-input').value.trim();
            const tema = document.getElementById('tema-input').value.trim();
            const franjasSeleccionadas = Array.from(document.querySelectorAll('.btn-time-slot.active')).map(b => b.dataset.time);

            if (!nombreLicenciado) {
                 mostrarMensaje('‚ùå Por favor, ingrese su nombre en la parte superior.', 'error');
                 return;
            }
            if (!materia) {
                mostrarMensaje('‚ùå Por favor, ingresa el nombre de la materia.', 'error');
                return;
            }
            if (franjasSeleccionadas.length === 0) {
                 mostrarMensaje('‚ùå Por favor, seleccione al menos una franja horaria.', 'error');
                 return;
            }

            const idsAusentes = [];
            const listaItems = document.querySelectorAll('#lista-asistencia li');

            listaItems.forEach(item => {
                if (item.dataset.status === 'ausente') {
                    idsAusentes.push(parseInt(item.dataset.id));
                }
            });
            
            // Incluir el nombre del licenciado, el curso y la franja horaria
            const nuevaSesion = {
                id: Date.now(),
                fecha: new Date().toLocaleDateString('es-ES'),
                licenciado: nombreLicenciado,
                cursoNombre: curso.nombre,
                materia: materia,
                tema: tema,
                franjas: franjasSeleccionadas,
                idsAusentes: idsAusentes
            };

            datos.sesiones.push(nuevaSesion);
            guardarDatos();
            mostrarMensaje(`‚úÖ Asistencia de ${materia} (${curso.nombre}) guardada.`);
            mostrarVista('menu');
        }


        // --- 4. Historial (Mejorado) ---

        function generarVistaHistorial() {
            if (datos.sesiones.length === 0) {
                return '<p class="text-gray-500 text-center py-10">A√∫n no hay registros de asistencia.</p>';
            }

            const sesionesOrdenadas = [...datos.sesiones].reverse();
            
            // Crear un diccionario de estudiantes por curso para mapear IDs
            const estudiantesPorCurso = {};
            datos.cursos.forEach(curso => {
                estudiantesPorCurso[curso.nombre] = Object.fromEntries(curso.estudiantes.map(e => [e.id, e.nombre]));
            });

            const historialHTML = sesionesOrdenadas.map(sesion => {
                const cursoActual = datos.cursos.find(c => c.nombre === sesion.cursoNombre);
                const total = cursoActual ? cursoActual.estudiantes.length : 0;
                const ausentes = sesion.idsAusentes.length;
                const presentes = total - ausentes;
                
                // Mapear ausentes usando el diccionario de estudiantes del curso
                const ausentesLista = ausentes > 0 
                    ? sesion.idsAusentes.map(id => {
                        const nombre = estudiantesPorCurso[sesion.cursoNombre] ? estudiantesPorCurso[sesion.cursoNombre][id] : null;
                        return `
                            <li class="text-sm text-red-600">
                                - ${nombre || `[ID ${id} - Alumno no encontrado]`}
                            </li>
                        `;
                    }).join('')
                    : '<li class="text-sm text-green-600 font-bold">¬°Todos presentes!</li>';
                
                const temaDetalle = sesion.tema ? `<p class="text-sm text-gray-500 mt-1">Tema: ${sesion.tema}</p>` : '';
                const franjasDetalle = sesion.franjas.join(', ');

                return `
                    <div class="bg-white p-4 rounded-xl shadow-lg border-l-4 border-blue-500 mb-6">
                        <div class="flex justify-between items-start border-b pb-2 mb-2">
                            <div>
                                <h3 class="text-xl font-bold text-blue-700">${sesion.materia} (${sesion.cursoNombre})</h3>
                                ${temaDetalle}
                                <p class="text-xs text-gray-600 mt-1">Por: ${sesion.licenciado}</p>
                            </div>
                            <span class="text-sm text-gray-500">${sesion.fecha}</span>
                        </div>
                        
                        <p class="text-sm font-semibold text-gray-700 mb-2">Horas: <span class="text-blue-600">${franjasDetalle}</span></p>

                        <div class="flex justify-around text-center mb-3 border-t pt-2">
                            <div class="p-1 bg-green-100 rounded-lg w-1/3">
                                <p class="text-lg font-extrabold text-green-700">${presentes}</p>
                                <p class="text-xs text-green-600">PRESENTES</p>
                            </div>
                            <div class="p-1 bg-red-100 rounded-lg w-1/3 mx-2">
                                <p class="text-lg font-extrabold text-red-700">${ausentes}</p>
                                <p class="text-xs text-red-600">AUSENTES</p>
                            </div>
                        </div>

                        <h4 class="font-semibold text-gray-700 mb-1">Detalle de Ausencias (${ausentes}):</h4>
                        <ul class="ml-4 list-none space-y-0.5">
                            ${ausentesLista}
                        </ul>
                    </div>
                `;
            }).join('');

            return `
                <div class="mt-4">
                    ${historialHTML}
                    <button onclick="limpiarHistorialCompleto()" class="w-full bg-red-500 hover:bg-red-600 text-white font-bold py-2 rounded-lg mt-4 transition duration-150 text-sm">
                        Limpiar TODO el Historial de Asistencia
                    </button>
                </div>
            `;
        }
        
        function limpiarHistorialCompleto() {
            if (confirm("‚ö†Ô∏è ADVERTENCIA FINAL: ¬øEst√°s ABSOLUTAMENTE seguro de que deseas eliminar TODOS los registros de asistencia de TODOS los cursos? Esta acci√≥n es irreversible.")) {
                datos.sesiones = [];
                guardarDatos();
                mostrarMensaje('üóëÔ∏è Todo el historial ha sido eliminado.');
                mostrarVista('historial');
            }
        }


        // --- 5. Acerca de ---
        function generarVistaAcerca() {
            return `
                <div class="p-4 bg-white rounded-xl shadow-lg space-y-4">
                    <h3 class="text-lg font-bold text-blue-700">Instrucciones R√°pidas</h3>
                    <ol class="list-decimal list-inside space-y-2 text-gray-700">
                        <li>**1. Su Nombre:** Ingrese su nombre (Lic. XXX) en el encabezado. Se guarda autom√°ticamente.</li>
                        <li>**2. Cursos:** Vaya a "Gestionar Cursos" para crear sus cursos (Ej: "2do Contabilidad").</li>
                        <li>**3. Listas:** Dentro de cada curso, a√±ada a los estudiantes de ese curso.</li>
                        <li>**4. Pasar Lista:** Vaya a "Tomar Asistencia", seleccione el curso, la **franja(s) horaria(s)** y la materia. Marque solo a los ausentes.</li>
                    </ol>
                    
                    <h3 class="text-lg font-bold text-blue-700 mt-6">C√≥mo "Instalar" la App (PWA)</h3>
                    <p class="text-gray-700">Abra este archivo, y su navegador le permitir√° instalarlo en su dispositivo para un acceso r√°pido (sin la barra de direcci√≥n).</p>
                    <ul class="list-disc list-inside space-y-2 text-gray-700">
                        <li>**En PC/Android (Chrome):** Busque el √≠cono de **Instalar** (un monitor con flecha) en la barra de direcciones.</li>
                        <li>**En iPhone/iPad (Safari):** Presione el √≠cono de **Compartir** y seleccione **"A√±adir a pantalla de inicio"**.</li>
                    </ul>
                </div>
            `;
        }


        // --- Inicializaci√≥n ---
        window.onload = () => {
            // Cargar el men√∫ principal al iniciar
            mostrarVista('menu');
        };
    </script>
</body>
</html>
